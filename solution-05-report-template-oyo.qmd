---
title: "04-report-template-oyo"
params:
  state: "Texas"
echo: true
---

```{r}
#| label: setup
#| mesage: false
#| warning: false

library(tidyverse)
library(janitor)
```

### Import your files

```{r}
#| label: import

all_outages <- read_rds("data-processed-power/power_outages.rds")

all_outages |> glimpse()
```

```{r}
state_list <- str_split_1(params$state, ",")
```

States: `r params$state`

```{r}
outages <- all_outages |>
  filter(state_event %in% state_list)

outages
```

### Do some analysis for your state

- What is the most common cause of power outages?
- What cause leads to the longest power outages?

#### Common cause of outages

```{r}
#| label: common-cause
 
outages |> 
  group_by (event_category) |> #<1>
  summarize(total_events = n()) |> #<2>
  arrange(total_events |> desc()) #<3>

```

1. Exclusively looking at event_category.
2. Counting how many times each event_category has occurred.
3. Ordering from most to least occurrences.

#### Cause of longest outages

```{r}
#| label: cause-longest

outages |> 
  group_by (event_category) |> #<1>
  summarize(avg_outage_length = mean(duration), total_occurences = n()) |> #<2>
  arrange(avg_outage_length |> desc(), total_occurences) #<3>
```

1. Exclusively looking at event_category.
2. Finding average duration (mean), and including occurrences for comparison.
3. Ordering from longest to shortest average outage length.