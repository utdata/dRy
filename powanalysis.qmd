---
title: "Power Analysis"
---

## Initial Questions

- What is the most common cause of power outages?
- What cause leads to the longest power outages?
- What state resolves issues the quickest? Longest?
- What state has the most outages? Least? -> Choropleth map, can do Texas and counties too


## Setup

```{r}
#| label: setup
#| message: false
#| warning: false

library(tidyverse)
library(janitor)
library(tigris)
library(sf)
```

## Import multiple files

```{r}
#| label: import
#| message: false
#| warning: false


power_files_list <- list.files(
  "data-processed-power",
  full.names = T
)

power_files_list
```

```{r}
#| label: combine-files
#| message: false
#| warning: false


power_all <- map(
  power_files_list,
  read_csv
) |>
  list_rbind() |>
  clean_names()

power_all |> glimpse()
```

## Longest Outage Events

```{r}
power_all |> arrange(duration |> desc()) 
```


## What is the most common cause of power outages?

```{r}
power_all |> group_by (event_category) |> 
  summarize(total_events = n()) |> 
  arrange(total_events |> desc())
```

```{r}
power_all |> group_by (event_category) |> 
  summarize(total_events = n()) |> 
  arrange(total_events |> desc())
```


## What cause leads to the longest power outages?

```{r}
power_all |> group_by (event_category) |> 
  summarize(avg_outage_length = mean(duration), total_occurences = n()) |> 
  arrange(avg_outage_length |> desc(), total_occurences)
```

## What state resolves issues the quickest? slowest?

```{r}
power_all |> group_by (state_event) |> 
  summarize(avg_event_length = mean(duration), total_occurences = n()) |> 
  arrange(avg_event_length)
```

```{r}

power_all |> group_by (state_event) |> 
  summarize(avg_event_length = mean(duration), total_occurences = n()) |> 
  arrange(avg_event_length |> desc())
```

## What state has the most outages? Least?

```{r}
power_all |> group_by (state_event) |> 
  summarize(total_outages = n()) |> 
  arrange(total_outages |> desc())
```

```{r}
power_all |> group_by (state_event) |> 
  summarize(total_outages = n()) |> 
  arrange(total_outages)
```

## Choropleth graph

```{r}
states <- states(cb = TRUE, class = "sf") # what does cb mean?
```

```{r}
power_states <- power_all |> group_by(state_event) |> 
  summarize(total_events = n())

power_states
```

```{r}
power_state_graph <- states |> 
  left_join(power_states, by = c("NAME" = "state_event")) |> 
  filter(!(NAME %in% c("Alaska", "Hawaii", "Guam", "American Samoa", "United States Virgin Islands", "Puerto Rico", "Commonwealth of the Northern Mariana Islands")))

```


```{r}
ggplot(power_state_graph) +
  geom_sf(aes(fill = total_events), color = "white", size = 0.2)
  # reverse coloring 
```

